<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.example.lms.mapper.EventMapper">

    <!-- 전체 학사 일정 -->
    <select id="selectEventList" resultType="com.example.lms.dto.Event">
        SELECT
            event_id       AS eventId,
            event_name     AS eventName,
            event_fromdate AS eventFromdate,
            event_todate   AS eventTodate,
            event_context  AS eventContext,
            user_id        AS userId,
            createdate,
            updatedate
        FROM events
        ORDER BY event_fromdate ASC
    </select>

    <!-- 다가오는 일정 (메인 페이지 요약) -->
    <select id="selectUpcomingEvents" resultType="com.example.lms.dto.Event">
        SELECT
            event_id       AS eventId,
            event_name     AS eventName,
            event_fromdate AS eventFromdate,
            event_todate   AS eventTodate,
            event_context  AS eventContext,
            user_id        AS userId,
            createdate,
            updatedate
        FROM events
        WHERE event_fromdate >= NOW()
        ORDER BY event_fromdate ASC
        LIMIT #{limit}
    </select>

    <!-- 상세 조회 -->
    <select id="selectEventOne" parameterType="long"
            resultType="com.example.lms.dto.Event">
        SELECT
            event_id       AS eventId,
            event_name     AS eventName,
            event_fromdate AS eventFromdate,
            event_todate   AS eventTodate,
            event_context  AS eventContext,
            user_id        AS userId,
            createdate,
            updatedate
        FROM events
        WHERE event_id = #{eventId}
    </select>

    <!-- 등록 -->
    <insert id="insertEvent" parameterType="com.example.lms.dto.Event">
        INSERT INTO events (
            event_name,
            event_fromdate,
            event_todate,
            event_context,
            user_id
        ) VALUES (
            #{eventName},
            #{eventFromdate},
            #{eventTodate},
            #{eventContext},
            #{userId}
        )
    </insert>

    <!-- 수정 -->
    <update id="updateEvent" parameterType="com.example.lms.dto.Event">
        UPDATE events
        SET
            event_name     = #{eventName},
            event_fromdate = #{eventFromdate},
            event_todate   = #{eventTodate},
            event_context  = #{eventContext}
        WHERE event_id = #{eventId}
    </update>

    <!-- 삭제 -->
    <delete id="deleteEvent" parameterType="long">
        DELETE FROM events
        WHERE event_id = #{eventId}
    </delete>
    
     <!-- 기간 내 학사 일정 (캘린더용) -->
    <select id="selectEventsBetween"
            resultType="com.example.lms.dto.Event">
        SELECT
            event_id       AS eventId,
            event_name     AS eventName,
            event_fromdate AS eventFromdate,
            event_todate   AS eventTodate,
            event_context  AS eventContext,
            user_id        AS userId,
            createdate,
            updatedate
        FROM events
        WHERE event_fromdate &lt; #{end}
          AND event_todate   &gt; #{start}
        ORDER BY event_fromdate ASC
    </select>

</mapper>